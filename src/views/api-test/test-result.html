<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <!-- import CSS -->
  <link rel="stylesheet" href="../css/index.css">
  <link rel="stylesheet" href="./css/test-result.css">
</head>

<body>
  <div id="app">
    <p style="text-align: center;" class="cascader"><el-cascader size="mini" @change="onFileSelect" placeholder="搜索" :options="options" filterable></el-cascader></p>
    <!-- 模板列表 -->
    <!-- common -->
    <!-- element-table -->
    
    <div class="row">
      <!-- 目标代码 -->
      <div class="code-wrapper">
        <el-button class="copy" type="primary" size="mini">复制</el-button>
        <pre class="code">{{code}}</pre>
      </div>
      <div class="api-layout">
      <!-- 历史url表(可设置别名,方便变量引用) -->
        <div class="api-history">
            <div class="api-history-item" v-for="item in apiList">
              {{item.url}}
            </div>
        </div>
        <!-- url返回值 -->
        <div class="api-rusult">
          <h1 style="text-align: center;">{{api.url}}的结果</h1>
          <pre>{{api.result}}</pre>
        </div>
      </div>
    </div>
  </div>
</body>
<!-- import Vue before Element -->
<script src="../js/vue.js"></script>
<script src="../js/vue-electron-plugin.js"></script>
<!-- import JavaScript -->
<script src="../js/element.js"></script>
<script>
  const fs = require("fs");
  const path = require("path");
  const templateMaker = require(path.resolve("./src/js/templateMaker.js"));
  new Vue({
    el: '#app',
    data() {
      function dirInfo(dir){
        let label = path.basename(dir);
        if(fs.statSync(dir).isDirectory()){
          let children = fs.readdirSync(dir).map(name=>dirInfo(path.join(dir,name)));
          return {
            value:dir,
            children,
            label
          }
        }else{
          return {value:dir,label};
        }
      }
      let options = dirInfo(path.resolve("./template"));
      return {
      options:options.children,
      api:this.$getParams()||{},
      code:"",
      apiList:[]
    }
    },
    methods: {
      onFileSelect(params){
        this.code = templateMaker.compile(fs.readFileSync(params[params.length-1]),this.api);
      },
      submit() {
        this.$getWindow().setResult(this.url);
      }
    },
    created(){
    }
  })
</script>

</html>